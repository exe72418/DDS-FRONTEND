{"version":3,"file":"ngxs-store-experimental.mjs","sources":["../../../packages/store/experimental/src/pending-tasks.ts","../../../packages/store/experimental/src/ngxs-store-experimental.ts"],"sourcesContent":["import { inject, ExperimentalPendingTasks } from '@angular/core';\nimport { ActionStatus, Actions, withNgxsPreboot } from '@ngxs/store';\n\n/**\n * This is an experimental feature that contributes to app stability,\n * which is required during server-side rendering. With asynchronous\n * actions being dispatched and handled, Angular is unaware of them in\n * zoneless mode and doesn't know whether the app is still unstable.\n * This may prematurely serialize the final HTML that is sent to the client.\n */\nexport function withExperimentalNgxsPendingTasks() {\n  return withNgxsPreboot(() => {\n    const pendingTasks = inject(ExperimentalPendingTasks);\n    const actions$ = inject(Actions);\n\n    const actionToRemoveTaskFnMap = new Map<any, () => void>();\n\n    actions$.subscribe(ctx => {\n      if (ctx.status === ActionStatus.Dispatched) {\n        const removeTaskFn = pendingTasks.add();\n        actionToRemoveTaskFnMap.set(ctx.action, removeTaskFn);\n      } else {\n        const removeTaskFn = actionToRemoveTaskFnMap.get(ctx.action);\n        if (typeof removeTaskFn === 'function') {\n          removeTaskFn();\n          actionToRemoveTaskFnMap.delete(ctx.action);\n        }\n      }\n    });\n  });\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":";;;AAGA;;;;;;AAMG;SACa,gCAAgC,GAAA;IAC9C,OAAO,eAAe,CAAC,MAAK;AAC1B,QAAA,MAAM,YAAY,GAAG,MAAM,CAAC,wBAAwB,CAAC,CAAC;AACtD,QAAA,MAAM,QAAQ,GAAG,MAAM,CAAC,OAAO,CAAC,CAAC;AAEjC,QAAA,MAAM,uBAAuB,GAAG,IAAI,GAAG,EAAmB,CAAC;AAE3D,QAAA,QAAQ,CAAC,SAAS,CAAC,GAAG,IAAG;AACvB,YAAA,IAAI,GAAG,CAAC,MAAM,KAAA,YAAA,gCAA8B;AAC1C,gBAAA,MAAM,YAAY,GAAG,YAAY,CAAC,GAAG,EAAE,CAAC;gBACxC,uBAAuB,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,EAAE,YAAY,CAAC,CAAC;aACvD;iBAAM;gBACL,MAAM,YAAY,GAAG,uBAAuB,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;AAC7D,gBAAA,IAAI,OAAO,YAAY,KAAK,UAAU,EAAE;AACtC,oBAAA,YAAY,EAAE,CAAC;AACf,oBAAA,uBAAuB,CAAC,MAAM,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;iBAC5C;aACF;AACH,SAAC,CAAC,CAAC;AACL,KAAC,CAAC,CAAC;AACL;;AC9BA;;AAEG;;;;"}